replicaCount: 1

ExternalSecret:
  enabled: false
  type: hashicorp
  # Supported types: hashicorp, aws, gcp, azure
  kvPath:
    - shiftlabsdev/dev/
  name: vault-backend
  # AWS Secrets Manager specific
  region: us-east-1
  # GCP Secret Manager specific
  projectId: ""
  # Azure Key Vault specific
  vaultUrl: ""

image:
  repository: nginx
  pullPolicy: Always
  tag: ""

imagePullSecrets:
  - name: registry-secret

nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}

podSecurityContext: {}
  # runAsNonRoot: true
  # seccompProfile:
  #   type: RuntimeDefault

env: []
  # - name: ENV_VAR_NAME
  #   value: "value"
  # - name: SECRET_ENV
  #   valueFrom:
  #     secretKeyRef:
  #       name: my-secret
  #       key: secret-key

securityContext: {}
  # allowPrivilegeEscalation: false
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # capabilities:
  #   drop:
  #     - ALL

service:
  type: ClusterIP
  loadBalancerIP: ""
  ports:
    - port: 80
      targetPort: 80
      name: http
      protocol: TCP
    - port: 8080
      targetPort: 8080
      name: custom-port-1
      protocol: TCP

initContainers:
  enabled: false
  containers: []
    # - name: "init-container"
    #   image: "busybox"
    #   command: ["sh"]
    #   args: ['-c', 'echo "INIT1"']
    # - name: "init-container2"
    #   image: "busybox"
    #   command: ["sh"]
    #   args: ['-c', 'echo "INIT2"']

ingress:
  enabled: false
  className: haproxy           # Kubernetes IngressClass name (any custom name)
  controllerType: haproxy      # "haproxy" or "nginx" — annotation format (independent of className)

  # ┌──────────────────────────────────────────────────────────────────┐
  # │ FEATURE SUPPORT:  [HAProxy: ✅ | NGINX: ✅] = both supported    │
  # │   ❌ (ConfigMap) = configure via controller ConfigMap instead    │
  # └──────────────────────────────────────────────────────────────────┘

  # Security Headers [HAProxy: ✅ | NGINX: ✅]
  securityHeaders:
    enabled: false
    hsts: true
    hstsMaxAge: 31536000
    hstsIncludeSubdomains: true
    hstsPreload: false
    frameOptions: "SAMEORIGIN"
    contentTypeNosniff: true
    xssProtection: "1; mode=block"
    referrerPolicy: "strict-origin-when-cross-origin"
    csp: ""

  ssl:
    redirect: true                          # [HAProxy: ✅ | NGINX: ✅]
    protocols: "TLSv1.2 TLSv1.3"           # [HAProxy: ❌ ConfigMap | NGINX: ✅]
    ciphers: ""                             # [HAProxy: ❌ ConfigMap | NGINX: ✅]

  proxy:
    bodySize: "8m"                          # [HAProxy: ❌ ConfigMap | NGINX: ✅]
    connectTimeout: 60                      # [HAProxy: ✅ | NGINX: ✅]
    sendTimeout: 60                         # [HAProxy: ✅ timeout-server | NGINX: ✅]
    readTimeout: 60                         # [HAProxy: ✅ timeout-server | NGINX: ✅]
    bufferSize: "4k"                        # [HAProxy: ❌ ConfigMap | NGINX: ✅]
    buffersNumber: 4                        # [HAProxy: ❌ ConfigMap | NGINX: ✅]
    nextUpstream: "error timeout"           # [HAProxy: ❌ ConfigMap | NGINX: ✅]
    nextUpstreamTries: 3                    # [HAProxy: ❌ ConfigMap | NGINX: ✅]

  rateLimit:                                # [HAProxy: ✅ | NGINX: ✅]
    enabled: false
    rps: 100
    burst: 200                              # [HAProxy: ❌ | NGINX: ✅]
    key: "$binary_remote_addr"

  cors:                                     # [HAProxy: ✅ | NGINX: ✅]
    enabled: false
    allowOrigin: "*"
    allowMethods: "GET, POST, PUT, DELETE, PATCH, OPTIONS"
    allowHeaders: "DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization"
    allowCredentials: true
    maxAge: 3600

  websocket:                                # [HAProxy: ✅ timeout-tunnel | NGINX: ✅ websocket-svc]
    enabled: false

  canary:                                   # [HAProxy: ❌ | NGINX: ✅]
    enabled: false
    weight: 0

  extraAnnotations: {}
  extraLabels: {}

  hosts:
    - host: fqdn.shiftlabs.dev
      paths:
        - path: /
          pathType: Prefix

  tls:
    - secretName: shiftlabsdev-ssl-cert
      hosts:
        - fqdn.shiftlabs.dev

ingressGRPC:
  enabled: false
  className: haproxy           # Kubernetes IngressClass name (any custom name)
  controllerType: haproxy      # "haproxy" or "nginx" — annotation format (independent of className)

  # [HAProxy: ✅ server-proto h2 | NGINX: ✅ backend-protocol GRPC]
  grpc:
    timeout: 300               # [HAProxy: ✅ timeout-tunnel | NGINX: ✅ grpc_read/send_timeout]
    maxMessageSize: "4m"       # [HAProxy: ❌ | NGINX: ✅ client_max_body_size]
    keepaliveTime: 30
    keepaliveTimeout: 10
    keepalivePermitWithoutCalls: false

  # Security Headers (same as HTTP ingress)
  securityHeaders:
    enabled: false
    hsts: true
    hstsMaxAge: 31536000
    hstsIncludeSubdomains: true
    hstsPreload: false
    frameOptions: "SAMEORIGIN"
    contentTypeNosniff: true
    xssProtection: "1; mode=block"
    referrerPolicy: "strict-origin-when-cross-origin"
    csp: ""

  # SSL/TLS Configuration
  ssl:
    redirect: true
    protocols: "TLSv1.2 TLSv1.3"
    ciphers: ""

  # Performance & Reliability
  proxy:
    bodySize: "8m"
    connectTimeout: 60
    sendTimeout: 60
    readTimeout: 60
    bufferSize: "4k"
    buffersNumber: 4
    nextUpstream: "error timeout"
    nextUpstreamTries: 3

  # Rate Limiting
  rateLimit:
    enabled: false
    rps: 100
    burst: 200
    key: "$binary_remote_addr"

  # Canary Deployment (NGINX only)
  canary:
    enabled: false
    weight: 0

  # Custom annotations
  extraAnnotations: {}

  # Extra labels
  extraLabels: {}

  hosts:
    - host: fqdn.shiftlabs.dev
      paths:
        - path: /
          pathType: Prefix

  tls:
    - secretName: shiftlabsdev-ssl-cert
      hosts:
        - fqdn.shiftlabs.dev

# Health Check Probes - Modern Best Practice Configuration
probes:
  # Startup Probe - For slow-starting applications
  # Protects liveness probe from killing container during startup
  startup:
    enabled: true
    type: http  # http, tcp, grpc, exec

    # HTTP probe configuration
    http:
      path: /api/v1/health/healthz
      port: http  # Can be port name or number
      scheme: HTTP
      httpHeaders: []
        # - name: Authorization
        #   value: Bearer token

    # TCP probe configuration
    tcp:
      port: 8080

    # GRPC probe configuration (Kubernetes 1.24+)
    grpc:
      port: 9090
      service: ""  # Optional gRPC service name

    # Exec probe configuration
    exec:
      command: []
        # - cat
        # - /tmp/healthy

    # Timing configuration - Tolerant for slow startup
    initialDelaySeconds: 0  # Kubernetes 1.20+ best practice
    periodSeconds: 10  # Check every 10 seconds
    timeoutSeconds: 1  # Request timeout
    failureThreshold: 30  # 30 * 10 = 300s (5 minutes) max startup time
    successThreshold: 1  # Success once = ready

  # Liveness Probe - Is the application running?
  # Should be conservative to avoid cascade failures
  liveness:
    enabled: true
    type: http

    http:
      path: /api/v1/health/readyz
      port: http
      scheme: HTTP
      httpHeaders: []

    tcp:
      port: 8080

    grpc:
      port: 9090
      service: ""

    exec:
      command: []

    # Timing configuration - Conservative
    initialDelaySeconds: 0  # Startup probe handles initial delay
    periodSeconds: 10  # Check every 10 seconds
    timeoutSeconds: 1
    failureThreshold: 3  # 3 failures = restart (30 seconds)
    successThreshold: 1

  # Readiness Probe - Is the application ready to serve traffic?
  # Should be responsive for quick traffic routing
  readiness:
    enabled: true
    type: http

    http:
      path: /api/v1/health/readyz
      port: http
      scheme: HTTP
      httpHeaders: []

    tcp:
      port: 8080

    grpc:
      port: 9090
      service: ""

    exec:
      command: []

    # Timing configuration - Responsive
    initialDelaySeconds: 0
    periodSeconds: 5  # Check every 5 seconds (faster recovery)
    timeoutSeconds: 1
    failureThreshold: 3  # 3 failures = remove from service (15 seconds)
    successThreshold: 1  # 1 success = add to service (5 seconds)

resources:
  limits:
    cpu: 250m
    memory: 250Mi
  requests:
    cpu: 250m
    memory: 250Mi

# StatefulSet specific configuration
statefulset:
  # Pod Management Policy: OrderedReady or Parallel
  podManagementPolicy: OrderedReady

  # Update strategy
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      partition: 0  # Update all pods (0 = update all, N = keep first N pods on old version)

  # Service name for headless service (stable network identity)
  # If empty, uses the fullname
  serviceName: ""

# Persistent Volume Claims
# Each replica gets its own PVC
persistence:
  enabled: true

  # Mount path for the default data volume
  # Default: /data
  mountPath: /data

  # Storage class for dynamic provisioning
  # If undefined, default storage class is used
  storageClass: ""

  # Access modes
  accessModes:
    - ReadWriteOnce

  # Storage size
  size: 10Gi

  # Additional volume claim templates
  # Useful for multiple volumes per pod
  volumeClaimTemplates: []
    # - name: logs
    #   mountPath: /var/log/app
    #   storageClass: fast-ssd
    #   accessModes:
    #     - ReadWriteOnce
    #   size: 20Gi
    # - name: cache
    #   mountPath: /tmp/cache
    #   storageClass: standard
    #   accessModes:
    #     - ReadWriteOnce
    #   size: 5Gi

  # PVC retention policy (Kubernetes 1.27+)
  persistentVolumeClaimRetentionPolicy:
    whenDeleted: Retain
    whenScaled: Retain
  # Ordinals configuration (Kubernetes 1.27+)
  ordinals:
    start: 0

networkPolicy:
  enabled: false
  defaultDeny: false
  allowDNS: true
  policyTypes:
    - Ingress
    - Egress
  ingress: []
    # - from:
    #   - namespaceSelector:
    #       matchLabels:
    #         name: default
    #   ports:
    #   - protocol: TCP
    #     port: 80
  egress: []
    # - to:
    #   - namespaceSelector: {}
    #   ports:
    #   - protocol: TCP
    #     port: 443

configmap:
  enabled: false
  keyValues:
    SPECIAL_KEY1: SPECIAL_KEY1
    SPECIAL_KEY2: SPECIAL_KEY2
  fileData:
    - fileName: custom-config1.yaml
      mountPath: /tmp
      content: |-
        key1: value1
        key2: value2
    - fileName: custom-config2.yaml
      mountPath: /tmp
      content: |-
        key3: value3
        key4: value4

# Scheduling
topologySpreadConstraints: []
terminationGracePeriodSeconds: 30
dnsPolicy: ""
dnsConfig: {}
hostAliases: []
priorityClassName: ""
runtimeClassName: ""
shareProcessNamespace: false

# Extra extensibility
extraVolumes: []
extraVolumeMounts: []
extraContainers: []
extraEnvFrom: []
extraInitContainers: []

# Lifecycle hooks
lifecycle: {}
  # preStop:
  #   exec:
  #     command: ["/bin/sh", "-c", "sleep 10"]
  # postStart:
  #   exec:
  #     command: ["/bin/sh", "-c", "echo started"]

# Labels & Annotations
podLabels: {}
commonLabels: {}
commonAnnotations: {}
component: ""
partOf: ""

# Monitoring
metrics:
  serviceMonitor:
    enabled: false
    additionalLabels: {}
    namespace: ""
    endpoints:
      - port: http
        path: /metrics
        interval: 30s
        scrapeTimeout: 10s
  podMonitor:
    enabled: false
    additionalLabels: {}
    namespace: ""
    podMetricsEndpoints:
      - port: http
        path: /metrics
        interval: 30s

# Vertical Pod Autoscaler
verticalPodAutoscaler:
  enabled: false
  updatePolicy:
    updateMode: "Auto"
  resourcePolicy:
    containerPolicies: []

nodeSelector: {}

tolerations: []

affinity: {}
