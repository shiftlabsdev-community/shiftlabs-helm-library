{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "replicaCount": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of pod replicas"
    },
    "ExternalSecret": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "type": {
          "type": "string",
          "enum": ["hashicorp", "aws", "gcp", "azure"],
          "description": "Type of secret provider"
        },
        "kvPath": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "name": {
          "type": "string"
        },
        "region": {
          "type": "string"
        },
        "projectId": {
          "type": "string"
        },
        "vaultUrl": {
          "type": "string"
        }
      }
    },
    "image": {
      "type": "object",
      "required": ["repository"],
      "properties": {
        "repository": {
          "type": "string",
          "description": "Container image repository"
        },
        "pullPolicy": {
          "type": "string",
          "enum": ["Always", "IfNotPresent", "Never"],
          "description": "Image pull policy"
        },
        "tag": {
          "type": "string",
          "description": "Image tag (defaults to Chart.AppVersion)"
        }
      }
    },
    "imagePullSecrets": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          }
        }
      }
    },
    "nameOverride": {
      "type": "string"
    },
    "fullnameOverride": {
      "type": "string"
    },
    "serviceAccount": {
      "type": "object",
      "properties": {
        "create": {
          "type": "boolean"
        },
        "annotations": {
          "type": "object"
        },
        "name": {
          "type": "string"
        }
      }
    },
    "podAnnotations": {
      "type": "object"
    },
    "podSecurityContext": {
      "type": "object",
      "properties": {
        "runAsNonRoot": {
          "type": "boolean"
        },
        "runAsUser": {
          "type": "integer",
          "minimum": 0
        },
        "fsGroup": {
          "type": "integer",
          "minimum": 0
        },
        "seccompProfile": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["RuntimeDefault", "Unconfined", "Localhost"]
            }
          }
        }
      }
    },
    "env": {
      "type": "array",
      "items": {
        "type": "object"
      }
    },
    "securityContext": {
      "type": "object",
      "properties": {
        "allowPrivilegeEscalation": {
          "type": "boolean"
        },
        "readOnlyRootFilesystem": {
          "type": "boolean"
        },
        "runAsNonRoot": {
          "type": "boolean"
        },
        "runAsUser": {
          "type": "integer",
          "minimum": 0
        },
        "capabilities": {
          "type": "object",
          "properties": {
            "drop": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "add": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "service": {
      "type": "object",
      "required": ["type", "ports"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["ClusterIP", "NodePort", "LoadBalancer", "ExternalName"]
        },
        "loadBalancerIP": {
          "type": "string"
        },
        "ports": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["port", "targetPort", "name"],
            "properties": {
              "port": {
                "type": "integer",
                "minimum": 1,
                "maximum": 65535
              },
              "targetPort": {
                "type": "integer",
                "minimum": 1,
                "maximum": 65535
              },
              "name": {
                "type": "string",
                "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$"
              },
              "protocol": {
                "type": "string",
                "enum": ["TCP", "UDP", "SCTP"]
              }
            }
          }
        }
      }
    },
    "initContainers": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "containers": {
          "type": "array",
          "items": {
            "type": "object"
          }
        }
      }
    },
    "postStart": {
      "type": "array"
    },
    "ingress": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "className": {
          "type": "string"
        },
        "securityHeaders": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "hsts": {
              "type": "boolean"
            },
            "hstsMaxAge": {
              "type": "integer",
              "minimum": 0
            },
            "hstsIncludeSubdomains": {
              "type": "boolean"
            },
            "hstsPreload": {
              "type": "boolean"
            },
            "frameOptions": {
              "type": "string",
              "enum": ["DENY", "SAMEORIGIN", "ALLOW-FROM"]
            },
            "contentTypeNosniff": {
              "type": "boolean"
            },
            "xssProtection": {
              "type": "string"
            },
            "referrerPolicy": {
              "type": "string"
            },
            "csp": {
              "type": "string"
            }
          }
        },
        "ssl": {
          "type": "object",
          "properties": {
            "redirect": {
              "type": "boolean"
            },
            "protocols": {
              "type": "string"
            },
            "ciphers": {
              "type": "string"
            }
          }
        },
        "proxy": {
          "type": "object",
          "properties": {
            "bodySize": {
              "type": "string"
            },
            "connectTimeout": {
              "type": "integer",
              "minimum": 0
            },
            "sendTimeout": {
              "type": "integer",
              "minimum": 0
            },
            "readTimeout": {
              "type": "integer",
              "minimum": 0
            },
            "bufferSize": {
              "type": "string"
            },
            "buffersNumber": {
              "type": "integer",
              "minimum": 1
            },
            "nextUpstream": {
              "type": "string"
            },
            "nextUpstreamTries": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "rateLimit": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "rps": {
              "type": "integer",
              "minimum": 1
            },
            "burst": {
              "type": "integer",
              "minimum": 1
            },
            "key": {
              "type": "string"
            }
          }
        },
        "cors": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "allowOrigin": {
              "type": "string"
            },
            "allowMethods": {
              "type": "string"
            },
            "allowHeaders": {
              "type": "string"
            },
            "allowCredentials": {
              "type": "boolean"
            },
            "maxAge": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "websocket": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            }
          }
        },
        "canary": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "weight": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            }
          }
        },
        "extraAnnotations": {
          "type": "object"
        },
        "extraLabels": {
          "type": "object"
        },
        "hosts": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["host"],
            "properties": {
              "host": {
                "type": "string"
              },
              "paths": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "path": {
                      "type": "string"
                    },
                    "pathType": {
                      "type": "string",
                      "enum": ["Exact", "Prefix", "ImplementationSpecific"]
                    }
                  }
                }
              }
            }
          }
        },
        "tls": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "secretName": {
                "type": "string"
              },
              "hosts": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "ingressGRPC": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "className": {
          "type": "string"
        },
        "grpc": {
          "type": "object",
          "properties": {
            "timeout": {
              "type": "integer",
              "minimum": 1
            },
            "maxMessageSize": {
              "type": "string"
            },
            "keepaliveTime": {
              "type": "integer",
              "minimum": 0
            },
            "keepaliveTimeout": {
              "type": "integer",
              "minimum": 0
            },
            "keepalivePermitWithoutCalls": {
              "type": "boolean"
            }
          }
        }
      }
    },
    "probes": {
      "type": "object",
      "properties": {
        "startup": {
          "$ref": "#/definitions/probe"
        },
        "liveness": {
          "$ref": "#/definitions/probe"
        },
        "readiness": {
          "$ref": "#/definitions/probe"
        }
      }
    },
    "resources": {
      "type": "object",
      "properties": {
        "limits": {
          "type": "object",
          "properties": {
            "cpu": {
              "type": "string",
              "pattern": "^[0-9]+m?$"
            },
            "memory": {
              "type": "string",
              "pattern": "^[0-9]+(Mi|Gi|Ki|M|G|K)?$"
            }
          }
        },
        "requests": {
          "type": "object",
          "properties": {
            "cpu": {
              "type": "string",
              "pattern": "^[0-9]+m?$"
            },
            "memory": {
              "type": "string",
              "pattern": "^[0-9]+(Mi|Gi|Ki|M|G|K)?$"
            }
          }
        }
      }
    },
    "autoscaling": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "type": {
          "type": "string",
          "enum": ["hpa", "keda"]
        },
        "minReplicas": {
          "type": "integer",
          "minimum": 1
        },
        "maxReplicas": {
          "type": "integer",
          "minimum": 1
        },
        "targetCPUUtilizationPercentage": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100
        },
        "targetMemoryUtilizationPercentage": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100
        }
      }
    },
    "podDisruptionBudget": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "minAvailable": {
          "oneOf": [
            {
              "type": "integer",
              "minimum": 0
            },
            {
              "type": "string",
              "pattern": "^[0-9]+%$"
            }
          ]
        },
        "maxUnavailable": {
          "oneOf": [
            {
              "type": "integer",
              "minimum": 0
            },
            {
              "type": "string",
              "pattern": "^[0-9]+%$"
            }
          ]
        }
      }
    },
    "networkPolicy": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "policyTypes": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["Ingress", "Egress"]
          }
        },
        "ingress": {
          "type": "array"
        },
        "egress": {
          "type": "array"
        }
      }
    },
    "configmap": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "keyValues": {
          "type": "object"
        },
        "fileData": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["fileName", "mountPath", "content"],
            "properties": {
              "fileName": {
                "type": "string"
              },
              "mountPath": {
                "type": "string"
              },
              "content": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "nodeSelector": {
      "type": "object"
    },
    "tolerations": {
      "type": "array"
    },
    "affinity": {
      "type": "object"
    }
  },
  "definitions": {
    "probe": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "type": {
          "type": "string",
          "enum": ["http", "tcp", "grpc", "exec"]
        },
        "http": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string"
            },
            "port": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 65535
                }
              ]
            },
            "scheme": {
              "type": "string",
              "enum": ["HTTP", "HTTPS"]
            },
            "httpHeaders": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "value": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "tcp": {
          "type": "object",
          "properties": {
            "port": {
              "type": "integer",
              "minimum": 1,
              "maximum": 65535
            }
          }
        },
        "grpc": {
          "type": "object",
          "properties": {
            "port": {
              "type": "integer",
              "minimum": 1,
              "maximum": 65535
            },
            "service": {
              "type": "string"
            }
          }
        },
        "exec": {
          "type": "object",
          "properties": {
            "command": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "initialDelaySeconds": {
          "type": "integer",
          "minimum": 0
        },
        "periodSeconds": {
          "type": "integer",
          "minimum": 1
        },
        "timeoutSeconds": {
          "type": "integer",
          "minimum": 1
        },
        "failureThreshold": {
          "type": "integer",
          "minimum": 1
        },
        "successThreshold": {
          "type": "integer",
          "minimum": 1
        }
      }
    }
  }
}
